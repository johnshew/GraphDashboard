<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Tesla Console</title>

    <style>
        .tight {
            margin-bottom: 0px;
            margin-top: 0px;
            margin-left: 0px;
            margin-right: 0px;
            padding: 0px
        }
    </style>
</head>

<body>
    <div class="container-fluid tight">
        <div class="row tight">
            <button id="LoginButton" onclick="Login()">Login</button>
            <button id="LogoutButton" onclick="Logout()">Logout</button>
        </div>
        <div id="Top" class="row tight">
            <p>
                <br/>Login AAD URL: <a href="https://login.microsoftonline.com/common/oauth2/authorize?response_type=id_token&client_id=b8dd3290-662a-4f91-92b9-3e70fbabe04e&redirect_uri=http%3A%2F%2Fjohnshew.github.io%2FGraphDashboard%2Ftest%2Ftest3.html&state=clientId%3Db8dd3290-662a-4f91-92b9-3e70fbabe04e%26tokenProcessorUrl%3Dhttp%3A%2F%2Fjohnshew.github.io%2FGraphDashboard%2Ftest%2F..%2Fpublic%2Flogin.html&nonce=5mcLkrghb2sWkHRSHHII09bZqpQc2Y8O">here</a>
                <br/>Logout AAD URL: <a href="https://login.microsoftonline.com/common/oauth2/logout?post_logout_redirect_uri=http://johnshew.github.io/GraphDashboard/test/test3.html;">here</a>
                <br/>This App Login URL: <a href="http://johnshew.github.io/GraphDashboard/test/test3.html#id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJiOGRkMzI5MC02NjJhLTRmOTEtOTJiOS0zZTcwZmJhYmUwNGUiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9kZjNhZDgwMi0wZmE4LTQzZjgtYWYyOC1lZTNiM2JlNDE4ZDMvIiwiaWF0IjoxNDUzMDg5NTUwLCJuYmYiOjE0NTMwODk1NTAsImV4cCI6MTQ1MzA5MzQ1MCwiYW1yIjpbInB3ZCJdLCJmYW1pbHlfbmFtZSI6IlNoZXciLCJnaXZlbl9uYW1lIjoiSm9obiIsIm5hbWUiOiJqb2huQHNoZXcubmV0Iiwibm9uY2UiOiIwRUdqUUV2VkhaeWpCb1A1MjRKdmxETzhLTjRmcHU4ZyIsIm9pZCI6IjFlYzUzYzBjLWZiYzktNDliYi05ZTcxLWJlMDkwZGI0ZGY4MyIsInN1YiI6IlR0Y29RNmEwTDZJSFVuVmQ3bFdZN2ZHNlZIS0ZjSmE2Y09wNVoyeTZkSWsiLCJ0aWQiOiJkZjNhZDgwMi0wZmE4LTQzZjgtYWYyOC1lZTNiM2JlNDE4ZDMiLCJ1bmlxdWVfbmFtZSI6ImpvaG5Ac2hldy5uZXQiLCJ1cG4iOiJqb2huQHNoZXcubmV0IiwidmVyIjoiMS4wIn0.fner-_WcrNplg7lHRX65aegS63zZ8b6mtb-FZug2yNtQxfntyJdlAH6pRCpS1kCuc8aFZjEvOP5TNbIR6UpYBGBsFmbU-bTPzyYiksIP-0qoaByKal1S7wFMewlmYn5KwMUqUV5rGueiJUQV8y-KgqROLYOSJmRJF-JGZWhoL8zaZItZkSVT9KDVqr6nAZnbjKMd3UXl1B30kL4-D6iJ0vZCrxipiC-RccC_qYw85kojg69U0HZgCaxUqId2H9TzrhcrhqN3m7m1yjGQLfaE4Nav_72QIFgrzQEv1sFa-CC1LB26DX2vqCxGgYN4gpxk0GLFhpITqVU-o7FPKhf9aA&state=clientId%3db8dd3290-662a-4f91-92b9-3e70fbabe04e%26tokenProcessorUrl%3dhttp%3a%2f%2fjohnshew.github.io%2fGraphDashboard%2ftest%2f..%2fpublic%2flogin.html&session_state=e14e9a85-9829-4cc8-993b-6154bc81a6ac">here</a>
            </p>
        </div>
        <div id="DebugConsole" class="row tight" style="display:none">
            <div id="DebugLog" class="col-sm-12 tight bg-info" style="margin:0px;padding:10px;background:SkyBlue"></div>
            <div class="col-sm-12 tight">
                <input id="DebugCmd" type="text" placeholder="> " style="width:100%" />
            </div>
        </div>

    </div>
    <script src="../public/kurve.js"></script>
    <script>
        (function () {
            var forceDebugConsole = true;
            var params = document.location.search.replace(/.*?\?/).split("&").map(function (kv) { return kv.split('='); }).reduce(function (prev, kva) { prev[kva[0]] = kva[1]; return prev }, {});
            if (forceDebugConsole || params["console"]) {
                var logger = document.getElementById('DebugLog');
                document.getElementById('DebugConsole').style.display = "";
                console.log = function (message) {
                    if (typeof message == 'object') {
                        try {
                            message = JSON && JSON.stringify ? JSON.stringify(message) : message;
                        } 
                        catch(err) {
                            message = "[Could not stringify that object]";
                        };
                    }                    
                    logger.innerHTML +=  '<p>' + message + '</p>';                
                    // console_log(message);
                };
                var cmd = document.getElementById('DebugCmd');
                cmd.onchange = function () {
                    var result = ""
                    try { result = eval(cmd.value); } catch(err) { result="Unable to evaluate " + cmd.value; }
                    console.log(result);
                    try { cmd.scrollIntoView(); } catch(err) {}
                }
            }            
        })();

        function InitializeApp() {
            console.log('Console started');
            var result = {};
            var here = window.location;
            result.identity = new Kurve.Identity("b8dd3290-662a-4f91-92b9-3e70fbabe04e", here.protocol + '//' + here.host + here.pathname.substring(0, here.pathname.lastIndexOf('/') + 1) + '../public/login.html');
            result.graph = new Kurve.Graph({identity: result.identity});
            return result;
        };
            
        var app = InitializeApp();        
        if (app.identity.checkForIdentityRedirect()) {
                document.getElementById("LoginButton").style.display = "none";
                onLogin();
        };

        function onLogin() {
                console.log('Login successful.');
                app.graph.me(function(me,err) { console.log('Got Me: ' + JSON.stringify(me.data));});                                            
        }

        function Login() {
            console.log('Login called.');
            app.identity.loginNoWindow(function (error) {
                console.log('Problem with Login');
            });
        }
        
        function Logout() {
            console.log('Logout called.');
            app.identity.logout();
        }
    </script>
</body>

</html>